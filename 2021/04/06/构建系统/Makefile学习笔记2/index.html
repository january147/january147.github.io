<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<meta name="hexo-config" content="{&quot;hostname&quot;:&quot;example.com&quot;,&quot;root&quot;:&quot;/&quot;,&quot;images&quot;:&quot;/images&quot;,&quot;scheme&quot;:&quot;Gemini&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;Searching...&quot;,&quot;empty&quot;:&quot;We didn&#39;t find any results for the search: ${query}&quot;,&quot;hits_time&quot;:&quot;${hits} results found in ${time} ms&quot;,&quot;hits&quot;:&quot;${hits} results found&quot;}}">
<meta name="description" content="Makefile学习笔记2&amp;emsp;&amp;emsp;这篇博客将介绍在Makefile中调用其他Makefile的方式并进一步介绍Makefile中的变量以及一些简单的通用编译规则的编写。 1. 在Makefile中调用其他Makefile&amp;emsp;&amp;emsp;当我们的源文件在多个目录中的时候给每个目录编写一个Makefile来编译该目录下的源代码是一个不错的方式，这就需要我们顶层目录的Makefi">
<meta property="og:type" content="article">
<meta property="og:title" content="Makefile学习笔记2">
<meta property="og:url" content="http://example.com/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/Makefile%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/index.html">
<meta property="og:site_name" content="January&#39;s blog">
<meta property="og:description" content="Makefile学习笔记2&amp;emsp;&amp;emsp;这篇博客将介绍在Makefile中调用其他Makefile的方式并进一步介绍Makefile中的变量以及一些简单的通用编译规则的编写。 1. 在Makefile中调用其他Makefile&amp;emsp;&amp;emsp;当我们的源文件在多个目录中的时候给每个目录编写一个Makefile来编译该目录下的源代码是一个不错的方式，这就需要我们顶层目录的Makefi">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-04-06T07:09:20.215Z">
<meta property="article:modified_time" content="2020-09-14T02:02:25.000Z">
<meta property="article:author" content="January">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/Makefile%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/">



<meta name="hexo-config-page" content="{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:false,&quot;isPost&quot;:true,&quot;lang&quot;:&quot;en&quot;}">
<meta name="hexo-config-calendar" content="">
<title>Makefile学习笔记2 | January's blog</title><script data-pjax src="/js/load-config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="January's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">January's blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Makefile%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02"><span class="nav-number">1.</span> <span class="nav-text">Makefile学习笔记2</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%9C%A8Makefile%E4%B8%AD%E8%B0%83%E7%94%A8%E5%85%B6%E4%BB%96Makefile"><span class="nav-number">1.1.</span> <span class="nav-text">1. 在Makefile中调用其他Makefile</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Makefile%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E4%BB%A5%E5%8F%8A%E5%9C%A8Makefile%E4%B8%AD%E4%BD%BF%E7%94%A8shell%E5%8F%98%E9%87%8F%EF%BC%88%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%EF%BC%89"><span class="nav-number">1.2.</span> <span class="nav-text">2. Makefile变量的作用域以及在Makefile中使用shell变量（环境变量）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E6%99%AE%E9%80%9A%E7%9A%84Makefile%E5%8F%98%E9%87%8F"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1 普通的Makefile变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2 环境变量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E9%80%9A%E7%94%A8%E7%BC%96%E8%AF%91%E8%A7%84%E5%88%99"><span class="nav-number">1.3.</span> <span class="nav-text">3. 通用编译规则</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">January</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">92</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/Makefile%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="January">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="January's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Makefile学习笔记2
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-06 15:09:20" itemprop="dateCreated datePublished" datetime="2021-04-06T15:09:20+08:00">2021-04-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-09-14 10:02:25" itemprop="dateModified" datetime="2020-09-14T10:02:25+08:00">2020-09-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">构建系统</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Makefile学习笔记2"><a href="#Makefile学习笔记2" class="headerlink" title="Makefile学习笔记2"></a>Makefile学习笔记2</h1><p>&emsp;&emsp;这篇博客将介绍在Makefile中调用其他Makefile的方式并进一步介绍Makefile中的变量以及一些简单的通用编译规则的编写。</p>
<h2 id="1-在Makefile中调用其他Makefile"><a href="#1-在Makefile中调用其他Makefile" class="headerlink" title="1. 在Makefile中调用其他Makefile"></a>1. 在Makefile中调用其他Makefile</h2><p>&emsp;&emsp;当我们的源文件在多个目录中的时候给每个目录编写一个Makefile来编译该目录下的源代码是一个不错的方式，这就需要我们顶层目录的Makefile能够调用下层目录的Makefile，通常，我们使用如下命令进行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sub_target: lower_level_dir</span><br><span class="line">	make -C lower_level_dir</span><br></pre></td></tr></table></figure>
<p>也可以使用这种方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sub_target: lower_level_dir</span><br><span class="line">	cd lower_level_dir; make</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：Makefile中，<strong>每一行</strong>的shell命令会在一个<strong>单独</strong>的shell中执行，如果多个shell命令需要共享shell变量或者工作目录，其需要编写在同一行并使用<code>;</code>隔开，所以改变工作目录的<code>cd</code>命令需要和在低层目录执行的<code>make</code>命令放在同一行。</p>
</blockquote>
<h2 id="2-Makefile变量的作用域以及在Makefile中使用shell变量（环境变量）"><a href="#2-Makefile变量的作用域以及在Makefile中使用shell变量（环境变量）" class="headerlink" title="2. Makefile变量的作用域以及在Makefile中使用shell变量（环境变量）"></a>2. Makefile变量的作用域以及在Makefile中使用shell变量（环境变量）</h2><h3 id="2-1-普通的Makefile变量"><a href="#2-1-普通的Makefile变量" class="headerlink" title="2.1 普通的Makefile变量"></a>2.1 普通的Makefile变量</h3><p>&emsp;&emsp;Makefile变量的作用范围为同一个Makefile文件，不同Makefile中定义的同名Makefile变量不会相互影响，即如果我们在一个Makefile中执行了make命令调用了另外一个Makefile，这个两个Makefile中的变量是完全独立的。下面是一个小测试。</p>
<p>目录结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Makefile</span><br><span class="line">other</span><br><span class="line">|-Makefile</span><br></pre></td></tr></table></figure>
<p>目录顶层Makefile</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Makefile a</span></span><br><span class="line">variable_a := hello</span><br><span class="line"></span><br><span class="line">all : </span><br><span class="line">	echo <span class="variable">$(variable_a)</span></span><br><span class="line">	cd other; make</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>other目录中的Makefile</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Makefile b</span></span><br><span class="line"><span class="section">all:</span></span><br><span class="line">	echo <span class="variable">$(variable_a)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">echo hello</span><br><span class="line">hello</span><br><span class="line">cd other; make</span><br><span class="line">make[1]: Entering directory &#39;&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;Desktop&#x2F;Makefile_test&#x2F;other&#39;</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">make[1]: Leaving directory &#39;&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;Desktop&#x2F;Makefile_test&#x2F;other&#39;</span><br></pre></td></tr></table></figure>
<p>可以看到，顶层Makefile中variable_a的内容为hello，其调用的other目录中的variable_a为空。在Makefile中调用make命令并不会传递变量。</p>
<blockquote>
<p>注意： 如果需要在命令中使用<code>$</code>字符，需要使用<code>$$</code>来进行转义。</p>
</blockquote>
<h3 id="2-2-环境变量"><a href="#2-2-环境变量" class="headerlink" title="2.2 环境变量"></a>2.2 环境变量</h3><p>&emsp;&emsp;在Makefile中，可以像调用普通Makefile变量一样调用环境变量（执行make命令的shell中的变量），例如下面一个小例子会打印我们常用的<code>PATH</code>环境变量。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Makefile c</span></span><br><span class="line">variable := <span class="variable">$(PATH)</span></span><br><span class="line">all : </span><br><span class="line">	echo <span class="variable">$(variable)</span></span><br></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;local&#x2F;games:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;system32:&#x2F;mnt&#x2F;c&#x2F;WINDOWS:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;System32&#x2F;Wbem:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;System32&#x2F;WindowsPowerShell&#x2F;v1.0&#x2F;:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;System32&#x2F;OpenSSH&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Program Files (x86)&#x2F;Intel&#x2F;Intel(R) Management Engine Components&#x2F;DAL:&#x2F;mnt&#x2F;c&#x2F;Program Files&#x2F;Intel&#x2F;Intel(R) Management Engine Components&#x2F;DAL:&#x2F;mnt&#x2F;c&#x2F;Program Files&#x2F;Git&#x2F;cmd:&#x2F;mnt&#x2F;c&#x2F;Program Files&#x2F;PuTTY&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Python&#x2F;Python37&#x2F;Scripts&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Python&#x2F;Python37&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Microsoft&#x2F;WindowsApps:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Microsoft VS Code&#x2F;bin:&#x2F;mnt&#x2F;c&#x2F;mingw-w64&#x2F;x86_64-8.1.0-posix-seh-rt_v6-rev0&#x2F;mingw64&#x2F;bin:&#x2F;mnt&#x2F;c&#x2F;my_apps&#x2F;sqlite:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Roaming&#x2F;Python&#x2F;Python37&#x2F;Scripts:&#x2F;snap&#x2F;bin&quot;</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;local&#x2F;games:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;system32:&#x2F;mnt&#x2F;c&#x2F;WINDOWS:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;System32&#x2F;Wbem:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;System32&#x2F;WindowsPowerShell&#x2F;v1.0&#x2F;:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;System32&#x2F;OpenSSH&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Program Files (x86)&#x2F;Intel&#x2F;Intel(R) Management Engine Components&#x2F;DAL:&#x2F;mnt&#x2F;c&#x2F;Program Files&#x2F;Intel&#x2F;Intel(R) Management Engine Components&#x2F;DAL:&#x2F;mnt&#x2F;c&#x2F;Program Files&#x2F;Git&#x2F;cmd:&#x2F;mnt&#x2F;c&#x2F;Program Files&#x2F;PuTTY&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Python&#x2F;Python37&#x2F;Scripts&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Python&#x2F;Python37&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Microsoft&#x2F;WindowsApps:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Microsoft VS Code&#x2F;bin:&#x2F;mnt&#x2F;c&#x2F;mingw-w64&#x2F;x86_64-8.1.0-posix-seh-rt_v6-rev0&#x2F;mingw64&#x2F;bin:&#x2F;mnt&#x2F;c&#x2F;my_apps&#x2F;sqlite:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Roaming&#x2F;Python&#x2F;Python37&#x2F;Scripts:&#x2F;snap&#x2F;bin</span><br></pre></td></tr></table></figure>

<p>可以看到,我们将环境变量<code>PATH</code>赋值给了一个普通的Makefile变量<code>variable</code>,并将其打印了出来。</p>
<blockquote>
<p>这里的输出结果好像把<code>variable</code>打印了两次，其实是因为make在执行shell命令前会默认打印将执行的shell命令<code>echo</code>和其参数，之后执行shell命令时<code>echo</code>再次输出了其参数，所以看起来打印了两次。我们可以在shell命令前输入一个<code>@</code>来避免make打印即将执行的shell命令。</p>
</blockquote>
<p>&emsp;&emsp;然而，在Makefile中给环境变量赋值和给普通shell变量赋值有一些不同，我们需要给赋值语句前加上<code>export</code>。我们修改上面小测试中的<code>Makefile a</code>,将<code>variable_a</code>变成环境变量。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Makefile a</span></span><br><span class="line"><span class="keyword">export</span> variable_a := hello</span><br><span class="line"></span><br><span class="line">all : </span><br><span class="line">	echo <span class="variable">$(variable_a)</span></span><br><span class="line">	cd other; make</span><br></pre></td></tr></table></figure>
<p>再次进行测试，输出结果为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">echo hello</span><br><span class="line">hello</span><br><span class="line">cd other; make</span><br><span class="line">make[1]: Entering directory &#39;&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;OneDrive&#x2F;blog&#x2F;example&#x2F;Makefile_test&#x2F;other&#39;</span><br><span class="line">echo hello</span><br><span class="line">hello</span><br><span class="line">make[1]: Leaving directory &#39;&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;OneDrive&#x2F;blog&#x2F;example&#x2F;Makefile_test&#x2F;other&#39;</span><br></pre></td></tr></table></figure>
<p>可以看到，由于<code>Makefile b</code>是在<code>Makefile a</code>的子shell中执行的，子shell会继承父shell的shell变量，因此使用<code>export</code>导出的环境变量（shell变量）从<code>Makefile a</code>传递到了<code>Makefile b</code>。然而，如果我们使用<code>export</code>在<code>Makefile b</code>中赋值任何环境变量，<code>Makefile a</code>中的变量是不会受到任何影响的，因为子shell的shell变量不会被传递给父shell。</p>
<h2 id="3-通用编译规则"><a href="#3-通用编译规则" class="headerlink" title="3. 通用编译规则"></a>3. 通用编译规则</h2><p>&emsp;&emsp;Makefile中可以使用通配符<code>%</code>来编写适用于同一类文件的通用编译，<code>%</code>可以匹配任意字符串，下面是一个常用的通用编译规则。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%.o : %.c:</span><br><span class="line">	gcc -c <span class="variable">$^</span> -o <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<p>这个规则表示任何<code>.o</code>文件都依赖与对应的<code>.c</code>文件, 并使用<code>gcc -c $^ -o $@</code>来从<code>.c</code>文件生成对应的<code>.o</code>文件。</p>
<blockquote>
<p>特殊变量$^保存了编译依赖项，$@保存了编译目标</p>
</blockquote>
<p>下面是一个更特殊的例子。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pro%.o : pro%.c commom.c:</span><br><span class="line">	gcc -c <span class="variable">$^</span> -o <span class="variable">$@</span></span><br></pre></td></tr></table></figure>
<p>这个规则表示任何以<code>pro</code>开头的<code>.o</code>文件都依赖与对应的以<code>pro</code>开头的<code>.c</code>文件以及<code>common.c</code>文件, 并使用<code>gcc -c $^ -o $@</code>来从<code>.c</code>文件生成对应的<code>.o</code>文件。</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/Makefile%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03/" rel="prev" title="Makefile学习笔记3">
                  <i class="fa fa-chevron-left"></i> Makefile学习笔记3
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/python%E6%9E%84%E5%BB%BApip%E5%8C%85/" rel="next" title="python构建pip包">
                  python构建pip包 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>





<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">January</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
