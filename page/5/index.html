<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<meta name="hexo-config" content="{&quot;hostname&quot;:&quot;example.com&quot;,&quot;root&quot;:&quot;/&quot;,&quot;images&quot;:&quot;/images&quot;,&quot;scheme&quot;:&quot;Gemini&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;Searching...&quot;,&quot;empty&quot;:&quot;We didn&#39;t find any results for the search: ${query}&quot;,&quot;hits_time&quot;:&quot;${hits} results found in ${time} ms&quot;,&quot;hits&quot;:&quot;${hits} results found&quot;}}">
<meta property="og:type" content="website">
<meta property="og:title" content="January&#39;s blog">
<meta property="og:url" content="http://example.com/page/5/index.html">
<meta property="og:site_name" content="January&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="January">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/5/">



<meta name="hexo-config-page" content="{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;en&quot;}">
<meta name="hexo-config-calendar" content="">
<title>January's blog</title><script data-pjax src="/js/load-config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="January's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">January's blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">January</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">92</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/06/%E5%BC%80%E5%8F%91%E8%80%85%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%85%AC%E9%92%A5%E5%AF%86%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="January">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="January's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/06/%E5%BC%80%E5%8F%91%E8%80%85%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%85%AC%E9%92%A5%E5%AF%86%E7%A0%81/" class="post-title-link" itemprop="url">公钥密码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-06 15:09:20" itemprop="dateCreated datePublished" datetime="2021-04-06T15:09:20+08:00">2021-04-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-12-17 10:04:45" itemprop="dateModified" datetime="2020-12-17T10:04:45+08:00">2020-12-17</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91%E8%80%85%E5%AF%86%E7%A0%81%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">开发者密码学</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="公钥密码"><a href="#公钥密码" class="headerlink" title="公钥密码"></a>公钥密码</h1><h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/06/%E5%BC%80%E5%8F%91%E8%80%85%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%85%AC%E9%92%A5%E5%AF%86%E7%A0%81%E5%AF%86%E9%92%A5%E6%A0%BC%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="January">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="January's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/06/%E5%BC%80%E5%8F%91%E8%80%85%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%85%AC%E9%92%A5%E5%AF%86%E7%A0%81%E5%AF%86%E9%92%A5%E6%A0%BC%E5%BC%8F/" class="post-title-link" itemprop="url">公钥密码密钥格式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-06 15:09:20" itemprop="dateCreated datePublished" datetime="2021-04-06T15:09:20+08:00">2021-04-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-12-22 19:28:13" itemprop="dateModified" datetime="2020-12-22T19:28:13+08:00">2020-12-22</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91%E8%80%85%E5%AF%86%E7%A0%81%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">开发者密码学</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>公钥密码密钥格式</p>
<h2 id="数据格式"><a href="#数据格式" class="headerlink" title="数据格式"></a>数据格式</h2><h3 id="AlgorithmIdentifier（x-509）"><a href="#AlgorithmIdentifier（x-509）" class="headerlink" title="AlgorithmIdentifier（x.509）"></a>AlgorithmIdentifier（x.509）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AlgorithmIdentifier  ::&#x3D;  SEQUENCE  &#123;</span><br><span class="line">    algorithm   OBJECT IDENTIFIER,</span><br><span class="line">    parameters  ANY DEFINED BY algorithm OPTIONAL</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="通用密钥格式"><a href="#通用密钥格式" class="headerlink" title="通用密钥格式"></a>通用密钥格式</h2><h2 id="PKCS-8-v1私钥（rfc5208）"><a href="#PKCS-8-v1私钥（rfc5208）" class="headerlink" title="PKCS_#8_v1私钥（rfc5208）"></a>PKCS_#8_v1私钥（rfc5208）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PrivateKeyInfo ::&#x3D; SEQUENCE &#123;</span><br><span class="line">    version                   Version,</span><br><span class="line">    privateKeyAlgorithm       PrivateKeyAlgorithmIdentifier,</span><br><span class="line">    privateKey                PrivateKey,</span><br><span class="line">    attributes           [0]  IMPLICIT Attributes OPTIONAL </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Version ::&#x3D; INTEGER(其值应该为0)</span><br><span class="line">PrivateKeyAlgorithmIdentifier ::&#x3D; AlgorithmIdentifier</span><br><span class="line">PrivateKey ::&#x3D; OCTET STRING</span><br><span class="line">Attributes ::&#x3D; SET OF Attribute</span><br></pre></td></tr></table></figure>

<h3 id="PKCS-8-v2私钥（rfc5958）"><a href="#PKCS-8-v2私钥（rfc5958）" class="headerlink" title="PKCS_#8_v2私钥（rfc5958）"></a>PKCS_#8_v2私钥（rfc5958）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">OneAsymmetricKey ::&#x3D; SEQUENCE &#123;</span><br><span class="line">       version                   Version,</span><br><span class="line">       privateKeyAlgorithm       PrivateKeyAlgorithmIdentifier,</span><br><span class="line">       privateKey                PrivateKey,</span><br><span class="line">       attributes            [0] Attributes OPTIONAL,</span><br><span class="line">       ...,</span><br><span class="line">       [[2: publicKey        [1] PublicKey OPTIONAL ]],</span><br><span class="line">       ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PrivateKeyInfo ::&#x3D; OneAsymmetricKey</span><br><span class="line"></span><br><span class="line">Version ::&#x3D; INTEGER（值应该为1）</span><br><span class="line"></span><br><span class="line">PrivateKeyAlgorithmIdentifier ::&#x3D; AlgorithmIdentifier</span><br><span class="line">&#123; PUBLIC-KEY,</span><br><span class="line">&#123; PrivateKeyAlgorithms &#125; &#125;</span><br><span class="line"></span><br><span class="line">PrivateKey ::&#x3D; OCTET STRING</span><br><span class="line">PublicKey ::&#x3D; BIT STRING</span><br><span class="line">Attributes ::&#x3D; SET OF Attribute &#123; &#123; OneAsymmetricKeyAttributes &#125; &#125;</span><br></pre></td></tr></table></figure>

<h3 id="SubjectPublicKeyInfo公钥（X-509）"><a href="#SubjectPublicKeyInfo公钥（X-509）" class="headerlink" title="SubjectPublicKeyInfo公钥（X.509）"></a>SubjectPublicKeyInfo公钥（X.509）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SubjectPublicKeyInfo  ::&#x3D;  SEQUENCE  &#123;</span><br><span class="line">    algorithm         AlgorithmIdentifier,</span><br><span class="line">    subjectPublicKey  BIT STRING</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="特定算法密钥格式"><a href="#特定算法密钥格式" class="headerlink" title="特定算法密钥格式"></a>特定算法密钥格式</h2><h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><h3 id="常规ECC"><a href="#常规ECC" class="headerlink" title="常规ECC"></a>常规ECC</h3><h4 id="sec1私钥-rfc-5915-SEC-1"><a href="#sec1私钥-rfc-5915-SEC-1" class="headerlink" title="sec1私钥(rfc 5915/SEC 1)"></a>sec1私钥(rfc 5915/SEC 1)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ECPrivateKey ::&#x3D; SEQUENCE &#123;</span><br><span class="line">    version        INTEGER &#123; ecPrivkeyVer1(1) &#125; (ecPrivkeyVer1),</span><br><span class="line">    privateKey     OCTET STRING,</span><br><span class="line">    parameters [0] ECParameters &#123;&#123; NamedCurve &#125;&#125; OPTIONAL,</span><br><span class="line">    publicKey  [1] BIT STRING OPTIONAL</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CHOICE类似UNION类型，即使用时只会包含定义成员中的任意一个</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ECParameters ::&#x3D; CHOICE &#123;</span><br><span class="line">    namedCurve         OBJECT IDENTIFIER</span><br><span class="line">    -- implicitCurve   NULL</span><br><span class="line">    -- specifiedCurve  SpecifiedECDomain</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">publickey ::&#x3D; ECPoint</span><br></pre></td></tr></table></figure>

<h4 id="公钥（GB-T-32918-1-2016）"><a href="#公钥（GB-T-32918-1-2016）" class="headerlink" title="公钥（GB/T 32918.1-2016）"></a>公钥（GB/T 32918.1-2016）</h4><p>椭圆曲线算法的公钥是一个椭圆曲线上的点(<code>ECPoint</code>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ECPoint ::&#x3D; OCTET STRING</span><br></pre></td></tr></table></figure>

<p>其具体格式如下，其中x和y是<strong>大端</strong>的<strong>无符号</strong>大整数，表示椭圆曲线上点的坐标，<code>||</code>表示字节连接</p>
<ol>
<li>压缩格式</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if y最低位比特值为0:</span><br><span class="line">	0x02 || x</span><br><span class="line">if y最低位比特值为1:</span><br><span class="line">	0x03 || x</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>非压缩格式</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x04 || x || y</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>混合格式</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if y最低位比特值为0:</span><br><span class="line">	0x06 || x || y</span><br><span class="line">if y最低位比特值为1:</span><br><span class="line">	0x07 || x || y</span><br></pre></td></tr></table></figure>

<h3 id="SM9"><a href="#SM9" class="headerlink" title="SM9"></a>SM9</h3><h4 id="KGC主私钥（GmSSL2-5-4）"><a href="#KGC主私钥（GmSSL2-5-4）" class="headerlink" title="KGC主私钥（GmSSL2.5.4）"></a>KGC主私钥（GmSSL2.5.4）</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ASN1_SEQUENCE_cb(SM9MasterSecret, sm9_master_key_cb) = &#123;</span><br><span class="line">	ASN1_SIMPLE(SM9_MASTER_KEY, pairing, ASN1_OBJECT),</span><br><span class="line">	ASN1_SIMPLE(SM9_MASTER_KEY, scheme, ASN1_OBJECT),</span><br><span class="line">	ASN1_SIMPLE(SM9_MASTER_KEY, hash1, ASN1_OBJECT),</span><br><span class="line">	ASN1_SIMPLE(SM9_MASTER_KEY, pointPpub, ASN1_OCTET_STRING),</span><br><span class="line">	ASN1_SIMPLE(SM9_MASTER_KEY, masterSecret, BIGNUM)</span><br><span class="line">&#125; ASN1_SEQUENCE_END_cb(SM9_MASTER_KEY, SM9MasterSecret)</span><br><span class="line">IMPLEMENT_ASN1_ENCODE_FUNCTIONS_const_fname(SM9_MASTER_KEY,SM9MasterSecret,SM9MasterSecret)</span><br></pre></td></tr></table></figure>

<p><strong>注意：截止2020.12.22日，SM9算法的标准文件尚未定义具体实现中使用的主私钥数据结构</strong></p>
<h4 id="KGC主公钥（公开参数）（GmSSL2-5-4）"><a href="#KGC主公钥（公开参数）（GmSSL2-5-4）" class="headerlink" title="KGC主公钥（公开参数）（GmSSL2.5.4）"></a>KGC主公钥（公开参数）（GmSSL2.5.4）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ASN1_SEQUENCE_cb(SM9PublicParameters, sm9_master_key_cb) &#x3D; &#123;</span><br><span class="line">	ASN1_SIMPLE(SM9_MASTER_KEY, pairing, ASN1_OBJECT),</span><br><span class="line">	ASN1_SIMPLE(SM9_MASTER_KEY, scheme, ASN1_OBJECT),</span><br><span class="line">	ASN1_SIMPLE(SM9_MASTER_KEY, hash1, ASN1_OBJECT),</span><br><span class="line">	ASN1_SIMPLE(SM9_MASTER_KEY, pointPpub, ASN1_OCTET_STRING)</span><br><span class="line">&#125; ASN1_SEQUENCE_END_cb(SM9_MASTER_KEY, SM9PublicParameters)</span><br><span class="line">IMPLEMENT_ASN1_ENCODE_FUNCTIONS_const_fname(SM9_MASTER_KEY,SM9PublicParameters,SM9PublicParameters)</span><br></pre></td></tr></table></figure>

<p><strong>注意：截止2020.12.22日，SM9算法的标准文件尚未定义具体实现中使用的主公钥数据结构</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/06/%E5%BC%80%E5%8F%91%E8%80%85%E5%AF%86%E7%A0%81%E5%AD%A6/ANS1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="January">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="January's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/06/%E5%BC%80%E5%8F%91%E8%80%85%E5%AF%86%E7%A0%81%E5%AD%A6/ANS1/" class="post-title-link" itemprop="url">ANS1</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-06 15:09:20" itemprop="dateCreated datePublished" datetime="2021-04-06T15:09:20+08:00">2021-04-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-12-23 19:24:22" itemprop="dateModified" datetime="2020-12-23T19:24:22+08:00">2020-12-23</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91%E8%80%85%E5%AF%86%E7%A0%81%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">开发者密码学</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ASN-1"><a href="#ASN-1" class="headerlink" title="ASN.1"></a>ASN.1</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>ASN.1抽象语法标记（Abstract Syntax Notation One） 是一种对多种格式的数据进行表示、编码、传输和解码的数据格式。其提供了一整套正规的格式用于描述对象的结构，独立于特定的计算机架构和编程语言，因此常用于编码需要网络传输的数据。</p>
<h2 id="基本编码格式"><a href="#基本编码格式" class="headerlink" title="基本编码格式"></a>基本编码格式</h2><h2 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h2><h3 id="OBJECT-IDENTIFIER（OID）"><a href="#OBJECT-IDENTIFIER（OID）" class="headerlink" title="OBJECT IDENTIFIER（OID）"></a>OBJECT IDENTIFIER（OID）</h3><p>OID由<strong>多个单元</strong>组成，其<strong>字符串格式</strong>为<code>1.2.345.678</code>，每个单元使用一个整数表示，不同单元使用<code>.</code>进行分割。在ASN.1编码中，一个OID单元由1个或多个字节进行存储，最后一个字节的第8bit（最高位）设置为0，其余字节的第8bit设置为1，以实现多个OID单元的区分。OID的单元的值存储在每个字节的低7bit，将OID单元包含的所有字节的低7bit连接起来构成一个<strong>大端无符号整数</strong>就是该OID单元的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Example:</span><br><span class="line">OID 1.2.345.678</span><br><span class="line">ASN.1编码 0x01 0x02 0x8259 0x8526</span><br></pre></td></tr></table></figure>

<blockquote>
<p>OID和NID</p>
<p>The ASN1 object utility functions process ASN1_OBJECT structures which are a representation of the ASN1 OBJECT IDENTIFIER (OID) type. For convenience, OIDs are usually represented in source code as numeric identifiers, or <strong>NID</strong>s. OpenSSL has an internal table of OIDs that are generated when the library is built, and their corresponding NIDs are available as defined constants. For the functions below, application code should treat all returned values – OIDs, NIDs, or names – as constants.</p>
<p>为方便代码实现，OPENSSL中使用NID来表示一个OID，即NID是OPENSSL内部的一种编号</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/06/%E5%BC%80%E5%8F%91%E8%80%85%E5%AF%86%E7%A0%81%E5%AD%A6/openssl%E5%85%AC%E9%92%A5%E5%AF%86%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="January">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="January's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/06/%E5%BC%80%E5%8F%91%E8%80%85%E5%AF%86%E7%A0%81%E5%AD%A6/openssl%E5%85%AC%E9%92%A5%E5%AF%86%E7%A0%81/" class="post-title-link" itemprop="url">openssl公钥密码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-06 15:09:20" itemprop="dateCreated datePublished" datetime="2021-04-06T15:09:20+08:00">2021-04-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-02-25 16:07:28" itemprop="dateModified" datetime="2021-02-25T16:07:28+08:00">2021-02-25</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%BC%80%E5%8F%91%E8%80%85%E5%AF%86%E7%A0%81%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">开发者密码学</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/python%E6%9E%84%E5%BB%BApip%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="January">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="January's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/python%E6%9E%84%E5%BB%BApip%E5%8C%85/" class="post-title-link" itemprop="url">python构建pip包</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-06 15:09:20" itemprop="dateCreated datePublished" datetime="2021-04-06T15:09:20+08:00">2021-04-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-02-26 16:07:50" itemprop="dateModified" datetime="2021-02-26T16:07:50+08:00">2021-02-26</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">构建系统</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="构建pip安装包"><a href="#构建pip安装包" class="headerlink" title="构建pip安装包"></a>构建pip安装包</h1><p>在python包目录（包含<code>__init__.py</code>文件的目录）的上一级目录创建如下<code>setup.py</code>文件，填充各个字段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> distutils.core <span class="keyword">import</span> setup</span><br><span class="line"><span class="keyword">import</span> setuptools</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name=<span class="string">&#x27;slime_table&#x27;</span>, <span class="comment"># 包的名字</span></span><br><span class="line">    version=<span class="string">&#x27;0.1.0&#x27;</span>,  <span class="comment"># 版本号</span></span><br><span class="line">    description=<span class="string">&#x27;表格内容显示工具，暂时仅支持终端输出表格（类似prettytable）&#x27;</span>,  <span class="comment"># 描述</span></span><br><span class="line">    author=<span class="string">&#x27;january&#x27;</span>, <span class="comment"># 作者</span></span><br><span class="line">    author_email=<span class="string">&#x27;january147@outlook.com&#x27;</span>,  <span class="comment"># 你的邮箱**</span></span><br><span class="line">    url=<span class="string">&#x27;&#x27;</span>,  <span class="comment"># 可以写github上的地址，或者其他地址</span></span><br><span class="line">    packages=setuptools.find_packages(),  <span class="comment"># 包内不需要引用的文件夹</span></span><br><span class="line">    <span class="comment"># 依赖包</span></span><br><span class="line">    install_requires=[</span><br><span class="line">    ],</span><br><span class="line">    zip_safe=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行<code>python setup.py sdist</code>即可在<code>dist</code>目录下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;</span><br><span class="line">|-- setup.py</span><br><span class="line">|-- dist</span><br><span class="line">|-- python_package</span><br><span class="line">    |-- __init__.py</span><br><span class="line">    |-- code.py</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/Makefile%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="January">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="January's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/Makefile%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/" class="post-title-link" itemprop="url">Makefile学习笔记2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-06 15:09:20" itemprop="dateCreated datePublished" datetime="2021-04-06T15:09:20+08:00">2021-04-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-09-14 10:02:25" itemprop="dateModified" datetime="2020-09-14T10:02:25+08:00">2020-09-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">构建系统</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Makefile学习笔记2"><a href="#Makefile学习笔记2" class="headerlink" title="Makefile学习笔记2"></a>Makefile学习笔记2</h1><p>&emsp;&emsp;这篇博客将介绍在Makefile中调用其他Makefile的方式并进一步介绍Makefile中的变量以及一些简单的通用编译规则的编写。</p>
<h2 id="1-在Makefile中调用其他Makefile"><a href="#1-在Makefile中调用其他Makefile" class="headerlink" title="1. 在Makefile中调用其他Makefile"></a>1. 在Makefile中调用其他Makefile</h2><p>&emsp;&emsp;当我们的源文件在多个目录中的时候给每个目录编写一个Makefile来编译该目录下的源代码是一个不错的方式，这就需要我们顶层目录的Makefile能够调用下层目录的Makefile，通常，我们使用如下命令进行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sub_target: lower_level_dir</span><br><span class="line">	make -C lower_level_dir</span><br></pre></td></tr></table></figure>
<p>也可以使用这种方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sub_target: lower_level_dir</span><br><span class="line">	cd lower_level_dir; make</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：Makefile中，<strong>每一行</strong>的shell命令会在一个<strong>单独</strong>的shell中执行，如果多个shell命令需要共享shell变量或者工作目录，其需要编写在同一行并使用<code>;</code>隔开，所以改变工作目录的<code>cd</code>命令需要和在低层目录执行的<code>make</code>命令放在同一行。</p>
</blockquote>
<h2 id="2-Makefile变量的作用域以及在Makefile中使用shell变量（环境变量）"><a href="#2-Makefile变量的作用域以及在Makefile中使用shell变量（环境变量）" class="headerlink" title="2. Makefile变量的作用域以及在Makefile中使用shell变量（环境变量）"></a>2. Makefile变量的作用域以及在Makefile中使用shell变量（环境变量）</h2><h3 id="2-1-普通的Makefile变量"><a href="#2-1-普通的Makefile变量" class="headerlink" title="2.1 普通的Makefile变量"></a>2.1 普通的Makefile变量</h3><p>&emsp;&emsp;Makefile变量的作用范围为同一个Makefile文件，不同Makefile中定义的同名Makefile变量不会相互影响，即如果我们在一个Makefile中执行了make命令调用了另外一个Makefile，这个两个Makefile中的变量是完全独立的。下面是一个小测试。</p>
<p>目录结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Makefile</span><br><span class="line">other</span><br><span class="line">|-Makefile</span><br></pre></td></tr></table></figure>
<p>目录顶层Makefile</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Makefile a</span></span><br><span class="line">variable_a := hello</span><br><span class="line"></span><br><span class="line">all : </span><br><span class="line">	echo <span class="variable">$(variable_a)</span></span><br><span class="line">	cd other; make</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>other目录中的Makefile</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Makefile b</span></span><br><span class="line"><span class="section">all:</span></span><br><span class="line">	echo <span class="variable">$(variable_a)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">echo hello</span><br><span class="line">hello</span><br><span class="line">cd other; make</span><br><span class="line">make[1]: Entering directory &#39;&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;Desktop&#x2F;Makefile_test&#x2F;other&#39;</span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">make[1]: Leaving directory &#39;&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;Desktop&#x2F;Makefile_test&#x2F;other&#39;</span><br></pre></td></tr></table></figure>
<p>可以看到，顶层Makefile中variable_a的内容为hello，其调用的other目录中的variable_a为空。在Makefile中调用make命令并不会传递变量。</p>
<blockquote>
<p>注意： 如果需要在命令中使用<code>$</code>字符，需要使用<code>$$</code>来进行转义。</p>
</blockquote>
<h3 id="2-2-环境变量"><a href="#2-2-环境变量" class="headerlink" title="2.2 环境变量"></a>2.2 环境变量</h3><p>&emsp;&emsp;在Makefile中，可以像调用普通Makefile变量一样调用环境变量（执行make命令的shell中的变量），例如下面一个小例子会打印我们常用的<code>PATH</code>环境变量。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Makefile c</span></span><br><span class="line">variable := <span class="variable">$(PATH)</span></span><br><span class="line">all : </span><br><span class="line">	echo <span class="variable">$(variable)</span></span><br></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;local&#x2F;games:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;system32:&#x2F;mnt&#x2F;c&#x2F;WINDOWS:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;System32&#x2F;Wbem:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;System32&#x2F;WindowsPowerShell&#x2F;v1.0&#x2F;:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;System32&#x2F;OpenSSH&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Program Files (x86)&#x2F;Intel&#x2F;Intel(R) Management Engine Components&#x2F;DAL:&#x2F;mnt&#x2F;c&#x2F;Program Files&#x2F;Intel&#x2F;Intel(R) Management Engine Components&#x2F;DAL:&#x2F;mnt&#x2F;c&#x2F;Program Files&#x2F;Git&#x2F;cmd:&#x2F;mnt&#x2F;c&#x2F;Program Files&#x2F;PuTTY&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Python&#x2F;Python37&#x2F;Scripts&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Python&#x2F;Python37&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Microsoft&#x2F;WindowsApps:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Microsoft VS Code&#x2F;bin:&#x2F;mnt&#x2F;c&#x2F;mingw-w64&#x2F;x86_64-8.1.0-posix-seh-rt_v6-rev0&#x2F;mingw64&#x2F;bin:&#x2F;mnt&#x2F;c&#x2F;my_apps&#x2F;sqlite:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Roaming&#x2F;Python&#x2F;Python37&#x2F;Scripts:&#x2F;snap&#x2F;bin&quot;</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;local&#x2F;games:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;system32:&#x2F;mnt&#x2F;c&#x2F;WINDOWS:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;System32&#x2F;Wbem:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;System32&#x2F;WindowsPowerShell&#x2F;v1.0&#x2F;:&#x2F;mnt&#x2F;c&#x2F;WINDOWS&#x2F;System32&#x2F;OpenSSH&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Program Files (x86)&#x2F;Intel&#x2F;Intel(R) Management Engine Components&#x2F;DAL:&#x2F;mnt&#x2F;c&#x2F;Program Files&#x2F;Intel&#x2F;Intel(R) Management Engine Components&#x2F;DAL:&#x2F;mnt&#x2F;c&#x2F;Program Files&#x2F;Git&#x2F;cmd:&#x2F;mnt&#x2F;c&#x2F;Program Files&#x2F;PuTTY&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Python&#x2F;Python37&#x2F;Scripts&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Python&#x2F;Python37&#x2F;:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Microsoft&#x2F;WindowsApps:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Microsoft VS Code&#x2F;bin:&#x2F;mnt&#x2F;c&#x2F;mingw-w64&#x2F;x86_64-8.1.0-posix-seh-rt_v6-rev0&#x2F;mingw64&#x2F;bin:&#x2F;mnt&#x2F;c&#x2F;my_apps&#x2F;sqlite:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;AppData&#x2F;Roaming&#x2F;Python&#x2F;Python37&#x2F;Scripts:&#x2F;snap&#x2F;bin</span><br></pre></td></tr></table></figure>

<p>可以看到,我们将环境变量<code>PATH</code>赋值给了一个普通的Makefile变量<code>variable</code>,并将其打印了出来。</p>
<blockquote>
<p>这里的输出结果好像把<code>variable</code>打印了两次，其实是因为make在执行shell命令前会默认打印将执行的shell命令<code>echo</code>和其参数，之后执行shell命令时<code>echo</code>再次输出了其参数，所以看起来打印了两次。我们可以在shell命令前输入一个<code>@</code>来避免make打印即将执行的shell命令。</p>
</blockquote>
<p>&emsp;&emsp;然而，在Makefile中给环境变量赋值和给普通shell变量赋值有一些不同，我们需要给赋值语句前加上<code>export</code>。我们修改上面小测试中的<code>Makefile a</code>,将<code>variable_a</code>变成环境变量。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Makefile a</span></span><br><span class="line"><span class="keyword">export</span> variable_a := hello</span><br><span class="line"></span><br><span class="line">all : </span><br><span class="line">	echo <span class="variable">$(variable_a)</span></span><br><span class="line">	cd other; make</span><br></pre></td></tr></table></figure>
<p>再次进行测试，输出结果为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">echo hello</span><br><span class="line">hello</span><br><span class="line">cd other; make</span><br><span class="line">make[1]: Entering directory &#39;&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;OneDrive&#x2F;blog&#x2F;example&#x2F;Makefile_test&#x2F;other&#39;</span><br><span class="line">echo hello</span><br><span class="line">hello</span><br><span class="line">make[1]: Leaving directory &#39;&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;janua&#x2F;OneDrive&#x2F;blog&#x2F;example&#x2F;Makefile_test&#x2F;other&#39;</span><br></pre></td></tr></table></figure>
<p>可以看到，由于<code>Makefile b</code>是在<code>Makefile a</code>的子shell中执行的，子shell会继承父shell的shell变量，因此使用<code>export</code>导出的环境变量（shell变量）从<code>Makefile a</code>传递到了<code>Makefile b</code>。然而，如果我们使用<code>export</code>在<code>Makefile b</code>中赋值任何环境变量，<code>Makefile a</code>中的变量是不会受到任何影响的，因为子shell的shell变量不会被传递给父shell。</p>
<h2 id="3-通用编译规则"><a href="#3-通用编译规则" class="headerlink" title="3. 通用编译规则"></a>3. 通用编译规则</h2><p>&emsp;&emsp;Makefile中可以使用通配符<code>%</code>来编写适用于同一类文件的通用编译，<code>%</code>可以匹配任意字符串，下面是一个常用的通用编译规则。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%.o : %.c:</span><br><span class="line">	gcc -c <span class="variable">$^</span> -o <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<p>这个规则表示任何<code>.o</code>文件都依赖与对应的<code>.c</code>文件, 并使用<code>gcc -c $^ -o $@</code>来从<code>.c</code>文件生成对应的<code>.o</code>文件。</p>
<blockquote>
<p>特殊变量$^保存了编译依赖项，$@保存了编译目标</p>
</blockquote>
<p>下面是一个更特殊的例子。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pro%.o : pro%.c commom.c:</span><br><span class="line">	gcc -c <span class="variable">$^</span> -o <span class="variable">$@</span></span><br></pre></td></tr></table></figure>
<p>这个规则表示任何以<code>pro</code>开头的<code>.o</code>文件都依赖与对应的以<code>pro</code>开头的<code>.c</code>文件以及<code>common.c</code>文件, 并使用<code>gcc -c $^ -o $@</code>来从<code>.c</code>文件生成对应的<code>.o</code>文件。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/Makefile%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="January">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="January's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/Makefile%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03/" class="post-title-link" itemprop="url">Makefile学习笔记3</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-04-06 15:09:20 / Modified: 08:33:30" itemprop="dateCreated datePublished" datetime="2021-04-06T15:09:20+08:00">2021-04-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">构建系统</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Makefile学习笔记3"><a href="#Makefile学习笔记3" class="headerlink" title="Makefile学习笔记3"></a>Makefile学习笔记3</h1><h2 id="命令执行修饰符"><a href="#命令执行修饰符" class="headerlink" title="命令执行修饰符"></a>命令执行修饰符</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># makefile</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	-rm -rf ./build</span><br></pre></td></tr></table></figure>

<p>默认情况下，如果一条命令执行错误（返回值不是0），make会终止执行。在命令前加短横线<code>-</code>可以让make忽略该条命令的错误，继续执行。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># makefile</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	@rm -rf ./build</span><br></pre></td></tr></table></figure>

<p>默认情况下，make会打印出执行的所有命令，通过在命令前加<code>@</code>可以让make不在屏幕上打印该条命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shell</span></span><br><span class="line">make -n clean</span><br><span class="line">make --just-print clean</span><br></pre></td></tr></table></figure>

<p>执行<code>make</code>时，使用<code>-n</code>或者<code>--just-print</code>选项可以让<code>make</code>仅仅打印要执行的命令而<strong>不会</strong>实际执行。</p>
<h2 id="内置函数和和变量"><a href="#内置函数和和变量" class="headerlink" title="内置函数和和变量"></a>内置函数和和变量</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">sort</span> &lt;字符串序列&gt;)</span></span><br><span class="line"><span class="comment"># 执行shell命令</span></span><br><span class="line"><span class="variable">$(<span class="built_in">shell</span> &lt;<span class="built_in">shell</span> 命令&gt;)</span></span><br><span class="line"><span class="comment"># 打印变量/打印提示</span></span><br><span class="line"><span class="variable">$(<span class="built_in">warning</span> &lt;variable&gt;)</span></span><br><span class="line"><span class="comment"># 通配符</span></span><br><span class="line"><span class="variable">$(<span class="built_in">wildcard</span> *.c)</span></span><br><span class="line"><span class="comment"># 变量替换</span></span><br><span class="line">$(&lt;variable&gt; : &lt;pattern a&gt;=&lt;pattern b&gt;)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/Makefile%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="January">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="January's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/Makefile%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/" class="post-title-link" itemprop="url">Makefile学习笔记1</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-06 15:09:20" itemprop="dateCreated datePublished" datetime="2021-04-06T15:09:20+08:00">2021-04-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-09-14 09:51:42" itemprop="dateModified" datetime="2020-09-14T09:51:42+08:00">2020-09-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">构建系统</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Makefile学习笔记1"><a href="#Makefile学习笔记1" class="headerlink" title="Makefile学习笔记1"></a>Makefile学习笔记1</h1><p>&emsp;&emsp;这里是我学习和使用Makefile时的一些经验，从为了编译时少输入一些字符而使用的最简单的Makefile开始，到能够处理好整个项目的相关依赖的复杂的Makefile，我将记录用到的基本语法和一些技巧。这篇博客介绍了Makefile的基本使用方法，包括最基本的格式和变量的简单使用。</p>
<h2 id="1-Makefile简介"><a href="#1-Makefile简介" class="headerlink" title="1. Makefile简介"></a>1. Makefile简介</h2><p>&emsp;&emsp;gnu make（后面简称make）是一种自动化的构建工具，一般用于从源代码构建可执行程序。 make根据Makefile中编写的规则来处理构建过程中各种文件之间的依赖关系并自动执行构建过程。</p>
<h2 id="2-Makefile的基本结构"><a href="#2-Makefile的基本结构" class="headerlink" title="2. Makefile的基本结构"></a>2. Makefile的基本结构</h2><p>&emsp;&emsp;在Makefile中，最主要的内容就是描述依赖关系以及构建命令（这两部分合起来为一个完整的编译规则），下面是一个最简单的Makefile。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hello_world : hello_world.c</span><br><span class="line">    gcc hello_world.c -o hello_word</span><br></pre></td></tr></table></figure>

<p>将上面这个Makefile和<code>hello_world.c</code>源代码放到同一目录中，并在该目录中执行<code>make</code>命令就会得到<code>hello_world</code>程序。在上面这个Makefile中，<code>hello_word</code>是构建目标，<code>hello_world.c</code>是构建<code>hello_world</code>所需的依赖文件，<code>gcc hello_world.c -o hello_word</code>是利用依赖生成目标的<code>shell</code>命令, 所以，简单的Makefile的格式如下：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">目标1 : 依赖文件1 依赖文件2 ...</span><br><span class="line">    生成目标的shell命令1</span><br><span class="line">    生成目标的shell命令2</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">目标2 : 依赖文件1 依赖文件2 ...</span><br><span class="line">    生成目标的shell命令1</span><br><span class="line">    生成目标的shell命令2</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>这里的每条shell命令前必须使用一个<strong>制表符（tab）</strong>来<strong>缩进</strong>，不缩进或者使用空格缩进都会导致错误。</p>
<p>&emsp;&emsp;当我们只执行make命令不指定目标参数时，make会尝试根据文件编写顺序找到第一个目标并调用目标的生成命令进行构建。如果该目标的某个依赖文件还不存在，make会在Makefile中搜索这个依赖文件的构建规则并先完成这个依赖文件的构建，再完成最终目标的构建。我们可以在调用make命令时指定构建目标，例如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make 目标2</span><br></pre></td></tr></table></figure>
<p>这样make会构建我们指定的目标。</p>
<h2 id="3-使用变量"><a href="#3-使用变量" class="headerlink" title="3. 使用变量"></a>3. 使用变量</h2><p>&emsp;&emsp;Makefile中可以使用变量，变量可以用于目标，依赖文件，shell命令等等位置，变量本身也可以为其他变量赋值，make在执行时会将这些变量替换成其保存的字符串。下面这个例子演示了Makefile的变量的基本使用方式：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">program := hello_word</span><br><span class="line">dependency := hello_world.c</span><br><span class="line"></span><br><span class="line"><span class="variable">$(program)</span> : <span class="variable">$(dpendency)</span></span><br><span class="line">    gcc <span class="variable">$(dependency)</span> -o <span class="variable">$(program)</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-变量赋值"><a href="#3-1-变量赋值" class="headerlink" title="3.1 变量赋值"></a>3.1 变量赋值</h3><h4 id="3-1-1-赋值符号赋值"><a href="#3-1-1-赋值符号赋值" class="headerlink" title="3.1.1 赋值符号赋值"></a>3.1.1 赋值符号赋值</h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式一</span></span><br><span class="line">program := hello_world</span><br><span class="line"><span class="comment"># 方式二</span></span><br><span class="line">program = hello_world</span><br><span class="line"><span class="comment"># 方式三</span></span><br><span class="line">program ?= hello_world</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;方式一为最普通的赋值方式，赋值符号为<code>:=</code>，方式二为递归赋值方式，赋值符号为<code>=</code>，方式三为条件赋值方式，赋值符号为<code>?=</code>。</p>
<p><code>?=</code>赋值方式只有在被赋值的变量为空的情况下才会执行赋值操作，而<code>:=</code>和<code>=</code>会始终执行赋值操作。当右值（赋值符号右边的值）中<strong>没有变量</strong>时，使用<code>:=</code>和<code>=</code>进行赋值的结果是一致的；当右值中有变量时，<code>:=</code>和<code>=</code>进行变量展开的方式有所不同。<code>:=</code>只对到当前行为止右值中的变量进行一次展开，所以各个变量的赋值顺序会影响赋值结果；而<code>=</code>则会搜索整个Makefile后对变量进行展开，所以各个变量的赋值顺序不会影响赋值结果。下面是一个简单的例子：</p>
<p>1） 使用<code>:=</code>赋值</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x:=<span class="variable">$(y)</span></span><br><span class="line">y=<span class="variable">$(z)</span></span><br><span class="line">z=hello</span><br><span class="line"></span><br><span class="line">all :</span><br><span class="line">    echo <span class="variable">$(x)</span></span><br><span class="line"></span><br><span class="line">z=haha</span><br></pre></td></tr></table></figure>
<p>执行这个Make会输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>即x的值为空，因为在第一行时变量y的值为空，变量y此时的值被直接赋给了x</p>
<p>2） 使用<code>=</code>赋值</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x=<span class="variable">$(y)</span></span><br><span class="line">y=<span class="variable">$(z)</span></span><br><span class="line">z=hello</span><br><span class="line"></span><br><span class="line">all :</span><br><span class="line">    echo <span class="variable">$(x)</span></span><br><span class="line"></span><br><span class="line">z=haha</span><br></pre></td></tr></table></figure>
<p>执行上面各种Makefile后会输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo haha</span><br><span class="line">haha</span><br></pre></td></tr></table></figure>
<p>即x的值为haha，x在使用时被递归展开，得到了变量z的最终值haha。</p>
<h4 id="3-1-2-make命令赋值"><a href="#3-1-2-make命令赋值" class="headerlink" title="3.1.2 make命令赋值"></a>3.1.2 make命令赋值</h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make program=hello_world</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在执行make命令时可以使用上述命令行参数来为变量赋值</p>
<h3 id="3-2-变量的使用"><a href="#3-2-变量的使用" class="headerlink" title="3.2 变量的使用"></a>3.2 变量的使用</h3><p>&emsp;&emsp;为变量赋值时只需要使用变量名即可，而使用变量时需要将变量名放在<code>$()</code>中，如果使用变量时变量没有放在<code>$()</code>中，其会被当做一个普通的字符串。下面的例子使用了program和dependency变量。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(program)</span> : <span class="variable">$(dpendency)</span></span><br><span class="line">    gcc <span class="variable">$(dependency)</span> -o <span class="variable">$(program)</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-特殊变量"><a href="#3-3-特殊变量" class="headerlink" title="3.3 特殊变量"></a>3.3 特殊变量</h3><p>&emsp;&emsp;除了自定义的变量外，Makefile中还有一些特殊的变量，例如</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hello_world : hello_world.c</span><br><span class="line">    gcc <span class="variable">$@</span> -o <span class="variable">$^</span></span><br></pre></td></tr></table></figure>
<p>其中<code>$@</code>表示所有依赖文件，在这里为<code>hello_world.c</code>，<code>$@</code>表示目标文件, 在这里为<code>hello_word</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/glibc%E7%BC%96%E8%AF%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="January">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="January's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/glibc%E7%BC%96%E8%AF%91/" class="post-title-link" itemprop="url">glibc编译</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-06 15:09:20" itemprop="dateCreated datePublished" datetime="2021-04-06T15:09:20+08:00">2021-04-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-11-10 22:39:20" itemprop="dateModified" datetime="2020-11-10T22:39:20+08:00">2020-11-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">构建系统</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="glibc交叉编译"><a href="#glibc交叉编译" class="headerlink" title="glibc交叉编译"></a>glibc交叉编译</h1><p><code>--host</code> 表示需要运行的目标平台</p>
<p><code>--build</code>表示用于编译的平台</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/Cmake%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="January">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="January's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/04/06/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/Cmake%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">Cmake学习笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-04-06 15:09:20" itemprop="dateCreated datePublished" datetime="2021-04-06T15:09:20+08:00">2021-04-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-03-19 13:29:51" itemprop="dateModified" datetime="2021-03-19T13:29:51+08:00">2021-03-19</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9E%84%E5%BB%BA%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">构建系统</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Cmake学习笔记"><a href="#Cmake学习笔记" class="headerlink" title="Cmake学习笔记"></a>Cmake学习笔记</h1><p>cmake是一种跨平台的构建系统，其规则文件为<code>CmakeLists.txt</code>. cmake使用各种命令来定义构建规则，基本命令如下：</p>
<p>定义项目名称</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">project</span>(<span class="string">&quot;demo_project&quot;</span>)</span><br><span class="line"><span class="keyword">project</span>(<span class="string">&quot;demo_project C&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>定义头文件目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include_directories()</span><br></pre></td></tr></table></figure>

<p>递归构建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_subdirectory()</span><br></pre></td></tr></table></figure>

<p>构建链接库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_library()</span><br></pre></td></tr></table></figure>

<p>构建可执行文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_executable()</span><br></pre></td></tr></table></figure>

<p>生成配置头文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configure_file()</span><br></pre></td></tr></table></figure>

<p>指定链接库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">link_libraries()</span><br><span class="line">target_link_libraries()</span><br></pre></td></tr></table></figure>

<p>指定链接库目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">link_diretories()</span><br><span class="line">target_link_directories()</span><br></pre></td></tr></table></figure>



<h2 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if()</span><br><span class="line">elseif()</span><br><span class="line">endif()</span><br></pre></td></tr></table></figure>

<p>条件运算符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">NOT</span><br><span class="line">MATCHES</span><br><span class="line">AND</span><br><span class="line">OR</span><br><span class="line">EXISTS</span><br><span class="line">IS_NEWER_THAN</span><br><span class="line">LESS</span><br><span class="line">GREATER</span><br><span class="line">EQUAL</span><br><span class="line">VERSION_LESS</span><br><span class="line">VERSION_EQUAL</span><br><span class="line">VERSION_GREATER</span><br><span class="line">DEFINED</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>
<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">January</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
